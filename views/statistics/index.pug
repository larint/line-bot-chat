extends ../layout

block style
  script(src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js")
  script(src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js")
  script(src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js")

  link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css")
  -var active_menu = 'statistic'

block main_title
  h3 LINE友達統計

block content
  .d-flex.flex-row.justify-content-between
    .w50
      span 日付
      .d-flex.flex-row.justify-content-between
        .date-wrap
          input.form-control.date-range(name="dates")
        div
          select.form-control#js-select-group
            each item in groupAll
              option(value=item.id)=item.name
            option(value="0") 全体
    div
      button.btn.btn-info.btn1 PDFダウンロード
  br
  div.table-statistic
  script.
    $('input[name="dates"]').daterangepicker({
       "locale": {
        "format": "YYYY/MM/DD"
       }
    });

    $('#js-select-group').change(function() {
      let id = $(this).val();
      var start_date = $('input[name="dates"]').data('daterangepicker').startDate._d;
      var end_date = $('input[name="dates"]').data('daterangepicker').endDate._d;

       $.ajax({
          type : 'POST',
          url : '/statistic/get-group-statistic',
          data: { id : id, start_date : start_date, end_date : end_date },
          success: function(res) {
            $('.table-statistic').html(res)
          },
          complete: function() {
            
          }
        })


    })
    
    $('#js-select-group').trigger('change')

